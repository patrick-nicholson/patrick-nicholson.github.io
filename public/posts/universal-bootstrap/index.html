<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  









  



  
  

<link rel="stylesheet" href="https://ptrcknchlsn.xyz/scss/main.min.css" />
  
<meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  

<title>Universal bootstrap</title>


<meta name="author" content="Patrick Nicholson">

<meta name="description" content="Shows how to use universal hash functions for bootstrapping">
<link rel="canonical" href="https://ptrcknchlsn.xyz/posts/universal-bootstrap/">
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Universal bootstrap">
<meta property="og:description" content="Shows how to use universal hash functions for bootstrapping">
<meta property="og:url" content="https://ptrcknchlsn.xyz/posts/universal-bootstrap/">
<meta property="article:published_time" content="2023-02-20T00:00:00-05:00">
  <meta property="article:modified_time" content="2023-07-12T17:44:51-04:00">
  

<meta property="og:image" content="https://ptrcknchlsn.xyz/posts/universal-bootstrap/images/feature.png"/>
  
    <meta property="og:image:alt" content="Example visualization of a bootstrap null versus a point estimate" />
  



<meta property="og:see_also" content="https://ptrcknchlsn.xyz/posts/universal-reservoir/" /><meta property="og:see_also" content="https://ptrcknchlsn.xyz/posts/visualization-trick/" /><meta property="og:see_also" content="https://ptrcknchlsn.xyz/posts/bootstrapping-in-sql/" /><meta property="og:see_also" content="https://ptrcknchlsn.xyz/posts/universal-sampling/" />



<meta name="twitter:title" content="Universal bootstrap">
<meta name="twitter:description" content="Shows how to use universal hash functions for bootstrapping">


<meta name="twitter:card" content="summary_large_image">
  <meta property="twitter:image" content="https://ptrcknchlsn.xyz/posts/universal-bootstrap/images/feature.png"/>
  
    <meta name="twitter:image:alt" content="Example visualization of a bootstrap null versus a point estimate">
  





  
    
  


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Person",
      "@id": "https://ptrcknchlsn.xyz/#/schema/person/1",
      "name": "Patrick Nicholson",
      "url": "https://ptrcknchlsn.xyz/",
      "image": {
        "@type": "ImageObject",
        "@id": "https://ptrcknchlsn.xyz/#/schema/image/1",
        "url": "https://ptrcknchlsn.xyz/\u003cnil\u003e",
        "width": null ,
        "height": null ,
        "caption": "Patrick Nicholson"
      }
    },
    {
      "@type": "WebSite",
      "@id": "https://ptrcknchlsn.xyz/#/schema/website/1",
      "url": "https://ptrcknchlsn.xyz/",
      "name": "Occasionally clever",
      "description": "The personal blog of Patrick Nicholson",
      "publisher": {
        "@id": "https://ptrcknchlsn.xyz/#/schema/person/1"
      }
    },
    {
      "@type": "WebPage",
      "@id": "https://ptrcknchlsn.xyz/posts/universal-bootstrap/",
      "url": "https://ptrcknchlsn.xyz/posts/universal-bootstrap/",
      "name": "Universal bootstrap: a superpower",
      "description": "Shows how to use universal hash functions for bootstrapping",
      "isPartOf": {
        "@id": "https://ptrcknchlsn.xyz/#/schema/website/1"
      },
      "about": {
        "@id": "https://ptrcknchlsn.xyz/#/schema/person/1"
      },
      "datePublished": "2023-02-20T00:00:00-05:00",
      "dateModified": "2023-07-12T17:44:51-04:00",
      "breadcrumb": {
        "@id": "https://ptrcknchlsn.xyz/posts/universal-bootstrap/#/schema/breadcrumb/1"
      },
      "primaryImageOfPage": {
        "@id": "https://ptrcknchlsn.xyz/posts/universal-bootstrap/#/schema/image/2"
      },
      "inLanguage": "en-US",
      "potentialAction": [{
        "@type": "ReadAction", "target": ["https://ptrcknchlsn.xyz/posts/universal-bootstrap/"]
      }]
    },
    {
      "@type": "BreadcrumbList",
      "@id": "https://ptrcknchlsn.xyz/posts/universal-bootstrap/#/schema/breadcrumb/1",
      "name": "Breadcrumbs",
      "itemListElement": [{
        "@type": "ListItem",
        "position":  1 ,
        "item": {
          "@type": "WebPage",
          "@id": "https://ptrcknchlsn.xyz",
          "url": "https://ptrcknchlsn.xyz",
          "name": "Home"
          }
        },{
        "@type": "ListItem",
        "position":  3 ,
        "item": {
          "@type": "WebPage",
          "@id": "https://ptrcknchlsn.xyz/posts/",
          "url": "https://ptrcknchlsn.xyz/posts/",
          "name": "Posts"
          }
        },{
        "@type": "ListItem",
        "position":  4 ,
        "item": {
          "@id": "https://ptrcknchlsn.xyz/posts/universal-bootstrap/"
          }
        }]
    },
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "Article",
          "@id": "https://ptrcknchlsn.xyz/#/schema/article/1",
          "headline": "Universal bootstrap: a superpower",
          "description": "Shows how to use universal hash functions for bootstrapping",
          "isPartOf": {
            "@id": "https://ptrcknchlsn.xyz/posts/universal-bootstrap/"
          },
          "mainEntityOfPage": {
            "@id": "https://ptrcknchlsn.xyz/posts/universal-bootstrap/"
          },
          "datePublished": "2023-02-20T00:00:00-05:00",
          "dateModified": "2023-07-12T17:44:51-04:00",
          "author": {
            "@id": "https://ptrcknchlsn.xyz/#/schema/person/1"
          },          
          "publisher": {
            "@id": "https://ptrcknchlsn.xyz/#/schema/person/1"
          },
          "image": {
            "@id": "https://ptrcknchlsn.xyz/posts/universal-bootstrap/#/schema/image/2"
          }
        }
      ]
    },{
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "ImageObject",
          "@id": "https://ptrcknchlsn.xyz/posts/universal-bootstrap/#/schema/image/2",
          "url": "https://ptrcknchlsn.xyz/posts/universal-bootstrap/images/feature.png",
          "contentUrl": "https://ptrcknchlsn.xyz/posts/universal-bootstrap/images/feature.png",
          "caption": "Example visualization of a bootstrap null versus a point estimate"
        }
      ]
    }
  ]
}
</script>
  

  

</head><body>
    <header class="container">
  <nav class="main-nav" id="js-navbar">
    
      <a class="logo" href="https://ptrcknchlsn.xyz">Occasionally clever</a>
    
    <ul class="menu" id="js-menu">
      
      
      <li class="menu-item--align">
        <div class="switch">
          <input class="switch-input" type="checkbox" id="themeSwitch">
          <label aria-hidden="true" class="switch-label" for="themeSwitch">On</label>
          <div aria-hidden="true" class="switch-marker"></div>
        </div>
      </li>
    </ul>
    <span class="nav-toggle" id="js-navbar-toggle">
      <svg xmlns="http://www.w3.org/2000/svg" id="Outline" viewBox="0 0 24 24" width="30" height="30" fill="var(--color-contrast-high)"><rect y="11" width="24" height="2" rx="1"/><rect y="4" width="24" height="2" rx="1"/><rect y="18" width="24" height="2" rx="1"/></svg>
    </span>
  </nav>
</header><main class="section">
<div class="container">
  <section class="page-header">
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
  </script>
  <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    <h1 class="page-header-title">Universal bootstrap: a superpower</h1>
    <div class="post-list-meta">
      <div class="post-list-dates">Posted:
  Feb 20, 2023&nbsp;&middot;&nbsp;
    Updated: Jul 12, 2023&nbsp;&middot;&nbsp;9 min.</div>
      
      
    </div>
    <p class="page-header-desc">
      <div class="single-feature-img">



  


<img class="feature-image" 
     srcset="/posts/universal-bootstrap/images/feature.png 480w, /posts/universal-bootstrap/images/feature.png 800w"
     sizes="(max-width: 600px) 480px, 800px"
     src="/posts/universal-bootstrap/images/feature.png"
     alt="Example visualization of a bootstrap null versus a point estimate">
</div>Bootstrapping is commonly used in computational statistics and machine learning for uncertainty quantification, hypothesis testing, and ensembling. By combining universal sampling with Poisson bootstrap, I show how the universal bootstrap unlocks incredibly sophisticated analysis at any scale in any tool.</p>
      <div class="series">
        <p>Part of the <a href="https://ptrcknchlsn.xyz/series/universal-sampling/">Universal Sampling</a> series:</p>
        
        <ol class="series-list">
            <li>
                <a href="https://ptrcknchlsn.xyz/posts/universal-sampling/">Universal sampling: better sampling for a better tomorrow</a>
              
            </li>
            <li>Universal bootstrap: a superpower<span class="series-this-post">This post!</span>
              
            </li>
            <li>
                <a href="https://ptrcknchlsn.xyz/posts/bootstrapping-in-sql/">Bootstrapping in SQL; or, getting s--- done with the tools you have</a>
              
            </li>
            <li>
                <a href="https://ptrcknchlsn.xyz/posts/visualization-trick/">A visualization trick obvious in hindsight</a>
              
            </li>
            <li>
                <a href="https://ptrcknchlsn.xyz/posts/universal-reservoir/">Universal reservoir: sampling a fixed number of elements from unbounded data</a>
              
            </li>
        </ol>
      </div>
    
    
  </section>
</div>
<div class="single-container-post">
  

  <div class="single-post-contents">
    
    
    <article class="markdown">
        <h1 id="universal-bootstrap-a-superpower">Universal bootstrap: a superpower<a href="#universal-bootstrap-a-superpower">
    <svg role="img" aria-labelledby="universal-bootstrap-a-superpower-IconTitle" fill="var(--color-primary)" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg">
      <title id="universal-bootstrap-a-superpower-IconTitle">Link to this heading</title>
      <path d="M0 0h24v24H0z" fill="none"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg>
  </a>
</h1><blockquote>
<p><em>Look on my computational methods, ye theorists, and despair</em></p>
</blockquote>
<p><a href="https://en.wikipedia.org/wiki/Bootstrapping_%28statistics%29" target="_blank" rel="noopener">Bootstrapping</a> is a commonly used technique for computational statistics and machine learning.</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Bootstrapping_%28statistics%29" target="_blank" rel="noopener">Uncertainty quantification</a>: an approximate distribution of a sample statistic (e.g., mean) is the empirical distribution of the same statistic calculated over bootstrap samples</li>
<li><a href="https://en.wikipedia.org/wiki/Bootstrapping_%28statistics%29#Bootstrap_hypothesis_testing" target="_blank" rel="noopener">Bootstrap tests</a>: a distribution-free hypothesis test by using the empirical distribution of the test statistic from bootstrap samples that randomize the test design</li>
<li><a href="https://en.wikipedia.org/wiki/Bootstrap_aggregating" target="_blank" rel="noopener">Bagging</a>: improving accuracy and reducing variance of a learner by training the model on subsets of resampled</li>
</ul>
<p>So how <em>should</em> you bootstrap? In an earlier post, I covered <a href="https://patrick-nicholson.github.io/2023/02/13/universal-sampling/" target="_blank" rel="noopener">universal sampling</a> and its advantages. In this post, I show how this can be extended with sampling with replacement to create the universal bootstrap.</p>


  <span class="code-language">python</span><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> statsmodels.formula.api <span style="color:#66d9ef">as</span> smf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> IPython.display <span style="color:#f92672">import</span> Markdown
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy <span style="color:#f92672">import</span> stats
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sklearn.datasets <span style="color:#f92672">import</span> load_iris
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sklearn.linear_model <span style="color:#f92672">import</span> LinearRegression
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sklearn.utils.murmurhash <span style="color:#f92672">import</span> murmurhash3_32
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> uuid <span style="color:#f92672">import</span> uuid4
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span>matplotlib inline
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>random_state <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>RandomState(<span style="color:#ae81ff">12345</span>)</span></span></code></pre></div>


  <span class="code-language">python</span><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>INT_MIN <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>int32(<span style="color:#f92672">-</span>(<span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">31</span>))
</span></span><span style="display:flex;"><span>INT_MAX <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>int32(<span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">31</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>INT_RANGE <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>int64(<span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>_mmhash_ufunc <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>frompyfunc(murmurhash3_32, nin<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, nout<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">mmhash</span>(values):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Wrapper for sklearn&#39;s MurmurHash that accepts most types&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> np<span style="color:#f92672">.</span>ndim(values):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> np<span style="color:#f92672">.</span>issubdtype(values<span style="color:#f92672">.</span>dtype, np<span style="color:#f92672">.</span>int32):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> murmurhash3_32(values)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> _mmhash_ufunc(values<span style="color:#f92672">.</span>astype(np<span style="color:#f92672">.</span>bytes_))<span style="color:#f92672">.</span>astype(np<span style="color:#f92672">.</span>int32)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> isinstance(values, (bytes, str, np<span style="color:#f92672">.</span>int32)):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> murmurhash3_32(values)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> _mmhash_ufunc(np<span style="color:#f92672">.</span>array(values, dtype<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>bytes_))</span></span></code></pre></div>
<h2 id="key-insight">Key insight<a href="#key-insight">
    <svg role="img" aria-labelledby="key-insight-IconTitle" fill="var(--color-primary)" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg">
      <title id="key-insight-IconTitle">Link to this heading</title>
      <path d="M0 0h24v24H0z" fill="none"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg>
  </a>
</h2><p>Bootstrapping is based on sampling with replacement. <a href="https://en.wikipedia.org/wiki/Poisson_sampling" target="_blank" rel="noopener">Poisson sampling</a> is one such method. For a sample size $N$ and resampling size $S$, the resampling weights for each observation follows the $\text{Pois} \left( \frac{S}{N} \right)$ distribution. The <a href="https://en.wikipedia.org/wiki/Bootstrapping_%28statistics%29#Poisson_bootstrap" target="_blank" rel="noopener">Poisson bootstrap</a>, commonly used for bootstrapping streams and large datasets, is the particular case where $N = S$, i.e., $\text{Pois}(1)$.</p>
<p>In <a href="https://patrick-nicholson.github.io/2023/02/13/universal-sampling/" target="_blank" rel="noopener">my earlier post</a>, I demonstrated a method of sampling from a Poisson distribution based on universal hash functions. Composing this with Poisson sampling gives us the universal bootstrap.</p>
<p>In short:</p>
<ul>
<li>A universal hash function deterministically maps an input to a uniformly distributed integer in the full integer range</li>
<li>Uniform integers can be transformed into Poisson values</li>
<li>Multiplying the hash value by another random integer yields an uncorrelated random integer</li>
<li>Ergo, mapping the products of a hash value by $r$ random integers to $\text{Pois}(1)$ values provides $r$ deterministic bootstrap sample weights</li>
</ul>


  <span class="code-language">python</span><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">poisson_thresholds</span>(lam, tol<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Threshold values (32-bit integers) for Poisson inverse transformation&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    tol <span style="color:#f92672">=</span> tol <span style="color:#f92672">or</span> <span style="color:#ae81ff">1e-6</span>
</span></span><span style="display:flex;"><span>    pois <span style="color:#f92672">=</span> stats<span style="color:#f92672">.</span>poisson(lam)
</span></span><span style="display:flex;"><span>    lower, upper <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>ceil(pois<span style="color:#f92672">.</span>isf([<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> tol, tol]))<span style="color:#f92672">.</span>astype(np<span style="color:#f92672">.</span>int32)
</span></span><span style="display:flex;"><span>    edges <span style="color:#f92672">=</span> (pois<span style="color:#f92672">.</span>cdf(np<span style="color:#f92672">.</span>arange(lower, upper)) <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">32</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">31</span>)<span style="color:#f92672">.</span>astype(
</span></span><span style="display:flex;"><span>        np<span style="color:#f92672">.</span>int32
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># compress int.min</span>
</span></span><span style="display:flex;"><span>    lower <span style="color:#f92672">+=</span> (edges <span style="color:#f92672">==</span> <span style="color:#f92672">-</span>(<span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">31</span>))<span style="color:#f92672">.</span>sum()
</span></span><span style="display:flex;"><span>    edges <span style="color:#f92672">=</span> edges[edges <span style="color:#f92672">&gt;</span> <span style="color:#f92672">-</span>(<span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">31</span>)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># compress int.max</span>
</span></span><span style="display:flex;"><span>    edges <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>r_[edges[edges <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">31</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>], <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">31</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    upper <span style="color:#f92672">=</span> lower <span style="color:#f92672">+</span> len(edges) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> lower, upper, edges
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">inverse_transform_search</span>(thresholds, hash_values):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Inverse transform search with correction to thin out tails when there are duplicated thresholds&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    left <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>searchsorted(thresholds, hash_values, side<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;left&#34;</span>)
</span></span><span style="display:flex;"><span>    right <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>searchsorted(thresholds, hash_values, side<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;right&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>where(hash_values <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>, right, left)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">poisson_sample_weight</span>(hashes, lam, tol<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Poisson weights for an array of hashes&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    lower, _, edges <span style="color:#f92672">=</span> poisson_thresholds(lam, tol)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> inverse_transform_search(edges, hashes) <span style="color:#f92672">+</span> lower</span></span></code></pre></div>
<h2 id="babys-first-bootstrap">Baby&rsquo;s first bootstrap<a href="#babys-first-bootstrap">
    <svg role="img" aria-labelledby="babys-first-bootstrap-IconTitle" fill="var(--color-primary)" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg">
      <title id="babys-first-bootstrap-IconTitle">Link to this heading</title>
      <path d="M0 0h24v24H0z" fill="none"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg>
  </a>
</h2><p>The first thing a little data scientist learns to do with a bootstrap is to estimate a distribution around some sample statistic. Let&rsquo;s use our old friend <code>iris</code> for this.</p>


  <span class="code-language">python</span><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>bootstrap_replications <span style="color:#f92672">=</span> <span style="color:#ae81ff">200</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>_ <span style="color:#f92672">=</span> load_iris(as_frame<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>iris <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([_[<span style="color:#e6db74">&#34;target&#34;</span>], _[<span style="color:#e6db74">&#34;data&#34;</span>]], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>iris<span style="color:#f92672">.</span>columns <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;_&#34;</span><span style="color:#f92672">.</span>join(k<span style="color:#f92672">.</span>split()[:<span style="color:#ae81ff">2</span>]) <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> iris]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>iris<span style="color:#f92672">.</span>head()</span></span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>5.1</td>
      <td>3.5</td>
      <td>1.4</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>4.9</td>
      <td>3.0</td>
      <td>1.4</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>4.7</td>
      <td>3.2</td>
      <td>1.3</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>4.6</td>
      <td>3.1</td>
      <td>1.5</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>5.0</td>
      <td>3.6</td>
      <td>1.4</td>
      <td>0.2</td>
    </tr>
  </tbody>
</table>
</div>
<p>We use this to estimate some sample statistic.</p>


  <span class="code-language">python</span><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>iris[<span style="color:#e6db74">&#34;sepal_length&#34;</span>]<span style="color:#f92672">.</span>mean()</span></span></code></pre></div>
<pre><code>5.843333333333334
</code></pre>
<p>A single bootstrap estimate is the same statistic applied to a resampled from the data. The empirical distribution of many different bootstrap replications is the bootstrap distribution of the statistic.</p>


  <span class="code-language">python</span><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>iris[<span style="color:#e6db74">&#34;sepal_length&#34;</span>]<span style="color:#f92672">.</span>sample(frac<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0</span>, replace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)<span style="color:#f92672">.</span>mean()</span></span></code></pre></div>
<pre><code>5.767333333333332
</code></pre>


  <span class="code-language">python</span><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>n <span style="color:#f92672">=</span> len(iris)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>baby_null <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>    iris[<span style="color:#e6db74">&#34;sepal_length&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>sample(frac<span style="color:#f92672">=</span>bootstrap_replications, replace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, ignore_index<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>groupby(<span style="color:#66d9ef">lambda</span> i: i <span style="color:#f92672">//</span> n)
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>mean()
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots()
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>hist(baby_null)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>axvline(iris[<span style="color:#e6db74">&#34;sepal_length&#34;</span>]<span style="color:#f92672">.</span>mean(), c<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#34;Bootstrap distribution of a sample statistic&#34;</span>);</span></span></code></pre></div>
<p>
	
	
	<img src="/posts/universal-bootstrap/images/output_14_0.png"
	width="543"
	height="433"
	
	alt="png" 
	class="single-post-image" 
	loading="lazy"
	decoding="async"
	>
</p>
<p>A single universal bootstrap estimate is the sample statistic weighted by Poisson weights. The universal bootstrap distribution repeats this by randomizing the hashes and repeating the weighting process.</p>


  <span class="code-language">python</span><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>baby_hashes <span style="color:#f92672">=</span> mmhash(iris<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>values)
</span></span><span style="display:flex;"><span>np<span style="color:#f92672">.</span>average(iris[<span style="color:#e6db74">&#34;sepal_length&#34;</span>], weights<span style="color:#f92672">=</span>poisson_sample_weight(baby_hashes, <span style="color:#ae81ff">1</span>))</span></span></code></pre></div>
<pre><code>5.844594594594595
</code></pre>


  <span class="code-language">python</span><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>randomization <span style="color:#f92672">=</span> random_state<span style="color:#f92672">.</span>randint(
</span></span><span style="display:flex;"><span>    INT_MIN, INT_MAX, bootstrap_replications, dtype<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>int32
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>baby_weights <span style="color:#f92672">=</span> poisson_sample_weight(
</span></span><span style="display:flex;"><span>    np<span style="color:#f92672">.</span>multiply<span style="color:#f92672">.</span>outer(baby_hashes, randomization), <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>poisson_baby_null <span style="color:#f92672">=</span> (baby_weights <span style="color:#f92672">*</span> iris[<span style="color:#e6db74">&#34;sepal_length&#34;</span>]<span style="color:#f92672">.</span>values[:, <span style="color:#66d9ef">None</span>])<span style="color:#f92672">.</span>sum(
</span></span><span style="display:flex;"><span>    axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>) <span style="color:#f92672">/</span> baby_weights<span style="color:#f92672">.</span>sum(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots()
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>hist(poisson_baby_null)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>axvline(iris[<span style="color:#e6db74">&#34;sepal_length&#34;</span>]<span style="color:#f92672">.</span>mean(), c<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#34;Universal bootstrap distribution of a sample statistic&#34;</span>);</span></span></code></pre></div>
<p>
	
	
	<img src="/posts/universal-bootstrap/images/output_17_0.png"
	width="543"
	height="433"
	
	alt="png" 
	class="single-post-image" 
	loading="lazy"
	decoding="async"
	>
</p>
<p>Of course, you can also do this by repeating observations based on the Poisson weights.</p>


  <span class="code-language">python</span><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>values <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>tile(iris[<span style="color:#e6db74">&#34;sepal_length&#34;</span>], bootstrap_replications)
</span></span><span style="display:flex;"><span>baby_weights <span style="color:#f92672">=</span> baby_weights<span style="color:#f92672">.</span>T<span style="color:#f92672">.</span>ravel()
</span></span><span style="display:flex;"><span>replications <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>repeat(np<span style="color:#f92672">.</span>arange(bootstrap_replications), len(iris))
</span></span><span style="display:flex;"><span>values, baby_weights, replications <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>    values[baby_weights <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>    baby_weights[baby_weights <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>    replications[baby_weights <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>repeated_estimates <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>    pd<span style="color:#f92672">.</span>Series(np<span style="color:#f92672">.</span>repeat(values, baby_weights))
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>groupby(np<span style="color:#f92672">.</span>repeat(replications, baby_weights))
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>mean()
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots()
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>hist(repeated_estimates)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>axvline(iris[<span style="color:#e6db74">&#34;sepal_length&#34;</span>]<span style="color:#f92672">.</span>mean(), c<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_title(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Universal bootstrap distribution of a sample statistic by repetition&#34;</span>
</span></span><span style="display:flex;"><span>);</span></span></code></pre></div>
<p>
	
	
	<img src="/posts/universal-bootstrap/images/output_19_0.png"
	width="571"
	height="433"
	
	alt="png" 
	class="single-post-image" 
	loading="lazy"
	decoding="async"
	>
</p>
<h2 id="universal-bootstrap-for-hypothesis-testing">Universal bootstrap for hypothesis testing<a href="#universal-bootstrap-for-hypothesis-testing">
    <svg role="img" aria-labelledby="universal-bootstrap-for-hypothesis-testing-IconTitle" fill="var(--color-primary)" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg">
      <title id="universal-bootstrap-for-hypothesis-testing-IconTitle">Link to this heading</title>
      <path d="M0 0h24v24H0z" fill="none"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg>
  </a>
</h2><p>While baby&rsquo;s first bootstrap was fun and all, the practical power of bootstrapping is revealed when estimating the $H_0$ distribution of a hypothesis test.</p>
<p>Given a sample of $N = n^T + n^C$ units with $n^T$ test units and $n^C$ control units, a single bootstrap iteration samples (with replacement) pseudo-test and pseudo-control groups; each pseudo group is (approximately) the same size as the true group. That is, we randomly assign (with replacement) each unit to the pseudo groups. The iteration&rsquo;s sample statistic (e.g., difference in means) is then calculated from the pseudo groups.</p>
<p>Let&rsquo;s simulate as simple experiment where an offer creates an average standardize effect of .1 on purchases.</p>


  <span class="code-language">python</span><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># number of customers</span>
</span></span><span style="display:flex;"><span>num_customers <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span><span style="color:#f92672">**</span><span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># percent of customers that received an offer</span>
</span></span><span style="display:flex;"><span>test_percent_offer <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.35</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># true effect of offer on standardized purchases</span>
</span></span><span style="display:flex;"><span>true_effect_offer <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># purchases across customers</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - customer_uuid: a UUID4 for the customer</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - customer_numeric_id: a serial ID for the customer</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - received_offer: customer received an offer (binary)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - purchases: standardized purchases</span>
</span></span><span style="display:flex;"><span>purchases <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        (
</span></span><span style="display:flex;"><span>            str(uuid4()),
</span></span><span style="display:flex;"><span>            numeric_id,
</span></span><span style="display:flex;"><span>            received_offer,
</span></span><span style="display:flex;"><span>            purchases <span style="color:#f92672">+</span> received_offer <span style="color:#f92672">*</span> offer_effect,
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> numeric_id, (received_offer, purchases, offer_effect) <span style="color:#f92672">in</span> enumerate(
</span></span><span style="display:flex;"><span>            zip(
</span></span><span style="display:flex;"><span>                random_state<span style="color:#f92672">.</span>binomial(<span style="color:#ae81ff">1</span>, test_percent_offer, num_customers),
</span></span><span style="display:flex;"><span>                random_state<span style="color:#f92672">.</span>normal(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, num_customers),
</span></span><span style="display:flex;"><span>                random_state<span style="color:#f92672">.</span>normal(
</span></span><span style="display:flex;"><span>                    true_effect_offer, true_effect_offer, num_customers
</span></span><span style="display:flex;"><span>                ),
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    columns<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;customer_uuid&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;customer_numeric_id&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;received_offer&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;purchases&#34;</span>,
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>The universal bootstrap is changed only slightly: we now generate test and control weights according to their sample sizes. Each replication has pseudo-test and pseudo-control samples, from which we calculate the test value.</p>


  <span class="code-language">python</span><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>test_randomization, control_randomization <span style="color:#f92672">=</span> random_state<span style="color:#f92672">.</span>randint(
</span></span><span style="display:flex;"><span>    INT_MIN, INT_MAX, (<span style="color:#ae81ff">2</span>, bootstrap_replications), np<span style="color:#f92672">.</span>int32
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>The test is then comparing the null distribution to the observed statistic from the true test and control groups.</p>


  <span class="code-language">python</span><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>offer_hashes <span style="color:#f92672">=</span> mmhash(purchases[<span style="color:#e6db74">&#34;customer_uuid&#34;</span>]<span style="color:#f92672">.</span>values)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>test_weights <span style="color:#f92672">=</span> poisson_sample_weight(
</span></span><span style="display:flex;"><span>    np<span style="color:#f92672">.</span>multiply<span style="color:#f92672">.</span>outer(offer_hashes, test_randomization), test_percent_offer
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>test <span style="color:#f92672">=</span> (test_weights<span style="color:#f92672">.</span>T <span style="color:#f92672">*</span> purchases[<span style="color:#e6db74">&#34;purchases&#34;</span>]<span style="color:#f92672">.</span>values)<span style="color:#f92672">.</span>sum(
</span></span><span style="display:flex;"><span>    axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>) <span style="color:#f92672">/</span> test_weights<span style="color:#f92672">.</span>sum(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">del</span> test_weights
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>control_weights <span style="color:#f92672">=</span> poisson_sample_weight(
</span></span><span style="display:flex;"><span>    np<span style="color:#f92672">.</span>multiply<span style="color:#f92672">.</span>outer(offer_hashes, control_randomization),
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">-</span> test_percent_offer,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>control <span style="color:#f92672">=</span> (control_weights<span style="color:#f92672">.</span>T <span style="color:#f92672">*</span> purchases[<span style="color:#e6db74">&#34;purchases&#34;</span>]<span style="color:#f92672">.</span>values)<span style="color:#f92672">.</span>sum(
</span></span><span style="display:flex;"><span>    axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>) <span style="color:#f92672">/</span> control_weights<span style="color:#f92672">.</span>sum(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">del</span> control_weights
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>offer_null_distribution <span style="color:#f92672">=</span> test <span style="color:#f92672">-</span> control
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>control, test <span style="color:#f92672">=</span> purchases<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#34;received_offer&#34;</span>)[<span style="color:#e6db74">&#34;purchases&#34;</span>]<span style="color:#f92672">.</span>mean()
</span></span><span style="display:flex;"><span>offer_point_est <span style="color:#f92672">=</span> test <span style="color:#f92672">-</span> control
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots()
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>hist(offer_null_distribution)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>axvline(offer_point_est, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>, ls<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;--&#34;</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_title(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Universal bootstrap test: null distribution vs. observed difference&#34;</span>
</span></span><span style="display:flex;"><span>);</span></span></code></pre></div>
<p>
	
	
	<img src="/posts/universal-bootstrap/images/output_25_0.png"
	width="567"
	height="433"
	
	alt="png" 
	class="single-post-image" 
	loading="lazy"
	decoding="async"
	>
</p>
<p>What if we have a more complicated experiment? Consider an educational intervention:</p>
<ul>
<li>A test is taken twice</li>
<li>An intervention is applied to some classes after the first test</li>
<li>Classes are not identical: they have different average test scores</li>
<li>Test scores improve over time</li>
</ul>
<p>This is intentionally set up for a difference-in-differences design.</p>


  <span class="code-language">python</span><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># number of classes</span>
</span></span><span style="display:flex;"><span>num_classes <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># average number of students in a class</span>
</span></span><span style="display:flex;"><span>avg_students <span style="color:#f92672">=</span> <span style="color:#ae81ff">25</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># average test scores differ between classes</span>
</span></span><span style="display:flex;"><span>between_class_sd <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># students improve on the test over time</span>
</span></span><span style="display:flex;"><span>true_trend <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># percent of classes receiving an intervention</span>
</span></span><span style="display:flex;"><span>test_percent_class <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.75</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># true effect of the intervention on standardized test scores</span>
</span></span><span style="display:flex;"><span>true_effect_intervention <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.05</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># test scores in two periods for students within classes</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - class_id: unique class identifier</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - student_num: anonymous student number within class</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - intervention_class: class received intervention (binary)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - post_period: score is for the second test (post intervention, if received)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - score: standardized test score</span>
</span></span><span style="display:flex;"><span>test_scores <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        (
</span></span><span style="display:flex;"><span>            class_id,
</span></span><span style="display:flex;"><span>            student_num,
</span></span><span style="display:flex;"><span>            intervention_class,
</span></span><span style="display:flex;"><span>            post_period,
</span></span><span style="display:flex;"><span>            start_score
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">+</span> post_period <span style="color:#f92672">*</span> trend
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">+</span> post_period <span style="color:#f92672">*</span> intervention_class <span style="color:#f92672">*</span> intervention_effect,
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> class_id, (
</span></span><span style="display:flex;"><span>            students,
</span></span><span style="display:flex;"><span>            class_avg_score,
</span></span><span style="display:flex;"><span>            intervention_class,
</span></span><span style="display:flex;"><span>        ) <span style="color:#f92672">in</span> enumerate(
</span></span><span style="display:flex;"><span>            zip(
</span></span><span style="display:flex;"><span>                random_state<span style="color:#f92672">.</span>poisson(avg_students, num_classes),
</span></span><span style="display:flex;"><span>                random_state<span style="color:#f92672">.</span>normal(<span style="color:#ae81ff">0</span>, between_class_sd, num_classes),
</span></span><span style="display:flex;"><span>                random_state<span style="color:#f92672">.</span>binomial(<span style="color:#ae81ff">1</span>, test_percent_class, num_classes),
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> student_num, (start_score, intervention_effect) <span style="color:#f92672">in</span> enumerate(
</span></span><span style="display:flex;"><span>            zip(
</span></span><span style="display:flex;"><span>                random_state<span style="color:#f92672">.</span>normal(class_avg_score, <span style="color:#ae81ff">1</span>, students),
</span></span><span style="display:flex;"><span>                random_state<span style="color:#f92672">.</span>normal(
</span></span><span style="display:flex;"><span>                    true_effect_intervention,
</span></span><span style="display:flex;"><span>                    true_effect_intervention <span style="color:#f92672">/</span> <span style="color:#ae81ff">2.8</span>,
</span></span><span style="display:flex;"><span>                    students,
</span></span><span style="display:flex;"><span>                ),
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> post_period, trend <span style="color:#f92672">in</span> enumerate(
</span></span><span style="display:flex;"><span>            random_state<span style="color:#f92672">.</span>normal(true_trend, true_trend <span style="color:#f92672">/</span> <span style="color:#ae81ff">2.8</span>, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    columns<span style="color:#f92672">=</span>[
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;class_id&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;student_num&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;intervention_class&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;post_period&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;score&#34;</span>,
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>)</span></span></code></pre></div>
<p>Correct measurement requires correct specification of standard errors. Standard covariances are too large to draw the correct inference; clustered standard errors are necessary.</p>


  <span class="code-language">python</span><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>fit <span style="color:#f92672">=</span> smf<span style="color:#f92672">.</span>ols(<span style="color:#e6db74">&#34;score ~ intervention_class * post_period&#34;</span>, test_scores)<span style="color:#f92672">.</span>fit()
</span></span><span style="display:flex;"><span>fit<span style="color:#f92672">.</span>summary(slim<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)</span></span></code></pre></div>
<table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>      <td>score</td>   <th>  R-squared:         </th> <td>   0.006</td>
</tr>
<tr>
  <th>Model:</th>               <td>OLS</td>    <th>  Adj. R-squared:    </th> <td>   0.005</td>
</tr>
<tr>
  <th>No. Observations:</th>  <td>  5034</td>   <th>  F-statistic:       </th> <td>   10.26</td>
</tr>
<tr>
  <th>Covariance Type:</th>  <td>nonrobust</td> <th>  Prob (F-statistic):</th> <td>9.91e-07</td>
</tr>
</table>
<table class="simpletable">
<tr>
                 <td></td>                   <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>                      <td>    0.0911</td> <td>    0.040</td> <td>    2.277</td> <td> 0.023</td> <td>    0.013</td> <td>    0.170</td>
</tr>
<tr>
  <th>intervention_class</th>             <td>   -0.1029</td> <td>    0.046</td> <td>   -2.239</td> <td> 0.025</td> <td>   -0.193</td> <td>   -0.013</td>
</tr>
<tr>
  <th>post_period</th>                    <td>    0.0986</td> <td>    0.057</td> <td>    1.741</td> <td> 0.082</td> <td>   -0.012</td> <td>    0.210</td>
</tr>
<tr>
  <th>intervention_class:post_period</th> <td>    0.0517</td> <td>    0.065</td> <td>    0.795</td> <td> 0.426</td> <td>   -0.076</td> <td>    0.179</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.


  <span class="code-language">python</span><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>fit<span style="color:#f92672">.</span>get_robustcov_results(
</span></span><span style="display:flex;"><span>    cov_type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cluster&#34;</span>, groups<span style="color:#f92672">=</span>test_scores[<span style="color:#e6db74">&#34;class_id&#34;</span>]
</span></span><span style="display:flex;"><span>)<span style="color:#f92672">.</span>summary(slim<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)</span></span></code></pre></div>
<table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>     <td>score</td>  <th>  R-squared:         </th> <td>   0.006</td> 
</tr>
<tr>
  <th>Model:</th>              <td>OLS</td>   <th>  Adj. R-squared:    </th> <td>   0.005</td> 
</tr>
<tr>
  <th>No. Observations:</th> <td>  5034</td>  <th>  F-statistic:       </th> <td>1.057e+04</td>
</tr>
<tr>
  <th>Covariance Type:</th>  <td>cluster</td> <th>  Prob (F-statistic):</th> <td>6.46e-124</td>
</tr>
</table>
<table class="simpletable">
<tr>
                 <td></td>                   <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>                      <td>    0.0911</td> <td>    0.039</td> <td>    2.342</td> <td> 0.021</td> <td>    0.014</td> <td>    0.168</td>
</tr>
<tr>
  <th>intervention_class</th>             <td>   -0.1029</td> <td>    0.048</td> <td>   -2.131</td> <td> 0.036</td> <td>   -0.199</td> <td>   -0.007</td>
</tr>
<tr>
  <th>post_period</th>                    <td>    0.0986</td> <td>    0.001</td> <td>   82.473</td> <td> 0.000</td> <td>    0.096</td> <td>    0.101</td>
</tr>
<tr>
  <th>intervention_class:post_period</th> <td>    0.0517</td> <td>    0.002</td> <td>   33.734</td> <td> 0.000</td> <td>    0.049</td> <td>    0.055</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors are robust to cluster correlation (cluster)
<p>As universal bootstrap is based on universal sampling, it is straightforward to implement complex designs. In this case, the intervention is applied at the class level, so we hash the class ID.</p>


  <span class="code-language">python</span><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>edu_hashes <span style="color:#f92672">=</span> mmhash(test_scores[<span style="color:#e6db74">&#34;class_id&#34;</span>]<span style="color:#f92672">.</span>values)
</span></span><span style="display:flex;"><span>edu_null <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros(bootstrap_replications)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, random <span style="color:#f92672">in</span> enumerate(
</span></span><span style="display:flex;"><span>    np<span style="color:#f92672">.</span>vstack([test_randomization, control_randomization])<span style="color:#f92672">.</span>T
</span></span><span style="display:flex;"><span>):
</span></span><span style="display:flex;"><span>    test_random, control_random <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>multiply<span style="color:#f92672">.</span>outer(edu_hashes, random)<span style="color:#f92672">.</span>T
</span></span><span style="display:flex;"><span>    test_weights <span style="color:#f92672">=</span> poisson_sample_weight(test_random, test_percent_class)
</span></span><span style="display:flex;"><span>    control_weights <span style="color:#f92672">=</span> poisson_sample_weight(
</span></span><span style="display:flex;"><span>        control_random, <span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> test_percent_class
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    df <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>        pd<span style="color:#f92672">.</span>concat(
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                test_scores<span style="color:#f92672">.</span>assign(test<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, weight<span style="color:#f92672">=</span>test_weights),
</span></span><span style="display:flex;"><span>                test_scores<span style="color:#f92672">.</span>assign(test<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, weight<span style="color:#f92672">=</span>control_weights),
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#34;weight &gt; 0&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">.</span>eval(<span style="color:#e6db74">&#34;test_post = test * post_period&#34;</span>)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ols <span style="color:#f92672">=</span> LinearRegression()<span style="color:#f92672">.</span>fit(
</span></span><span style="display:flex;"><span>        df[[<span style="color:#e6db74">&#34;test&#34;</span>, <span style="color:#e6db74">&#34;post_period&#34;</span>, <span style="color:#e6db74">&#34;test_post&#34;</span>]], df[<span style="color:#e6db74">&#34;score&#34;</span>]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    edu_null[i] <span style="color:#f92672">=</span> ols<span style="color:#f92672">.</span>coef_[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>edu_point_est <span style="color:#f92672">=</span> fit<span style="color:#f92672">.</span>params[<span style="color:#e6db74">&#34;intervention_class:post_period&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots()
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>hist(edu_null)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>axvline(edu_point_est, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>, ls<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;--&#34;</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_title(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Clustered universal bootstrap: null distribution vs. point estimate&#34;</span>
</span></span><span style="display:flex;"><span>);</span></span></code></pre></div>
<p>
	
	
	<img src="/posts/universal-bootstrap/images/output_32_0.png"
	width="568"
	height="433"
	
	alt="png" 
	class="single-post-image" 
	loading="lazy"
	decoding="async"
	>
</p>
<h2 id="wrapping-up">Wrapping up<a href="#wrapping-up">
    <svg role="img" aria-labelledby="wrapping-up-IconTitle" fill="var(--color-primary)" height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg">
      <title id="wrapping-up-IconTitle">Link to this heading</title>
      <path d="M0 0h24v24H0z" fill="none"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg>
  </a>
</h2><p>Universal bootstrap is simply the application of Poisson bootstrap leveraging the strengths of universal sampling. It provides true determinism; efficiency in dataset or streams of any size; and straightforward application of complex sampling designs. In my next post, I&rsquo;ll cover how this can be done in SQL.</p>

    </article>
    <aside>
      <div class="single-terms">
        
          
          <a class="term" href="https://ptrcknchlsn.xyz/tags/computational-statistics/">computational statistics</a></li>
          
          <a class="term" href="https://ptrcknchlsn.xyz/tags/bootstrapping/">bootstrapping</a></li>
          
          <a class="term" href="https://ptrcknchlsn.xyz/tags/big-data/">big data</a></li>
          
        
      </div>
      
  
  
  

  <section>
    <h2>Share</h2>
    <div class="social-links">
      <ul class="social-icons--share">
        
        
        
        
        
        
        
        
        <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fptrcknchlsn.xyz%2fposts%2funiversal-bootstrap%2f&amp;source=https%3a%2f%2fptrcknchlsn.xyz%2fposts%2funiversal-bootstrap%2f&amp;title=Universal%20bootstrap%3a%20a%20superpower&amp;summary=Universal%20bootstrap%3a%20a%20superpower" target="_blank" rel="noopener" aria-label="Share on LinkedIn" class="social-btn linkedin">
          <li><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-linkedin" width="24" height="24" viewBox="0 0 352 352" fill="var(--color-primary)"><path d="M0,40v272c0,21.9,18.1,40,40,40h272c21.9,0,40-18.1,40-40V40c0-21.9-18.1-40-40-40H40C18.1,0,0,18.1,0,40z M312,32 c4.6,0,8,3.4,8,8v272c0,4.6-3.4,8-8,8H40c-4.6,0-8-3.4-8-8V40c0-4.6,3.4-8,8-8H312z M59.5,87c0,15.2,12.3,27.5,27.5,27.5 c15.2,0,27.5-12.3,27.5-27.5c0-15.2-12.3-27.5-27.5-27.5C71.8,59.5,59.5,71.8,59.5,87z M187,157h-1v-21h-45v152h47v-75 c0-19.8,3.9-39,28.5-39c24.2,0,24.5,22.4,24.5,40v74h47v-83.5c0-40.9-8.7-72-56.5-72C208.5,132.5,193.3,145.1,187,157z M64,288h47.5 V136H64V288z"/></svg></li>
        </a>
        
        
        
        <a href="mailto:?subject=Occasionally%20clever%20-%20Universal%20bootstrap%3a%20a%20superpower.&amp;body=Universal%20bootstrap%3a%20a%20superpower%2c%20by%20Occasionally%20clever%0aShows%20how%20to%20use%20universal%20hash%20functions%20for%20bootstrapping%0a%0ahttps%3a%2f%2fptrcknchlsn.xyz%2fposts%2funiversal-bootstrap%2f%0a" target="_blank" class="social-btn email">
          <li><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-mail" width="24" height="24" viewBox="0 0 416 288" fill="var(--color-primary)"><path d="m0 16v256 16h16 384 16v-16-256-16h-16-384-16zm347 16-139 92.5-139-92.5zm-148 125.5 9 5.5 9-5.5 167-111.5v210h-352v-210z"/></svg></li>
        </a>
      </ul>
    </div>
  </section>
  
        <div class="series">
          <p>Part of the <a href="https://ptrcknchlsn.xyz/series/universal-sampling/">Universal Sampling</a> series:</p>
          
          <ol>
              <li>
                  <a href="https://ptrcknchlsn.xyz/posts/universal-sampling/">Universal sampling: better sampling for a better tomorrow</a>
                
              </li>
              <li>Universal bootstrap: a superpower<span class="series-this-post">This post!</span>
                
              </li>
              <li>
                  <a href="https://ptrcknchlsn.xyz/posts/bootstrapping-in-sql/">Bootstrapping in SQL; or, getting s--- done with the tools you have</a>
                
              </li>
              <li>
                  <a href="https://ptrcknchlsn.xyz/posts/visualization-trick/">A visualization trick obvious in hindsight</a>
                
              </li>
              <li>
                  <a href="https://ptrcknchlsn.xyz/posts/universal-reservoir/">Universal reservoir: sampling a fixed number of elements from unbounded data</a>
                
              </li>
          </ol>
        </div>
      
      
    </aside>
  </div>
</div>

    </main><footer>
    
    <div class="section footer">
      <p class="footer-copyright">&copy; 2023 &middot; 
        Patrick Nicholson
        
      </p>
      
        <div class="footer-socials">
          
<div class="social-links">
  <ul class="social-icons">
    
    

    
    
    <li>
      <a href="https://github.com/patrick-nicholson" target="_blank" rel="noopener" aria-label="Visit Github profile" class="social-btn github">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-github" width="24" height="24" viewBox="0 0 24 24" fill="var(--color-primary)"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
      </a>
    </li>
    

    
    

    
    
    <li>
      <a href="https://www.linkedin.com/in/nicholsonpatrick" target="_blank" rel="noopener" aria-label="Visit LinkedIn profile" class="social-btn linkedin">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-linkedin" width="24" height="24" viewBox="0 0 352 352" fill="var(--color-primary)"><path d="M0,40v272c0,21.9,18.1,40,40,40h272c21.9,0,40-18.1,40-40V40c0-21.9-18.1-40-40-40H40C18.1,0,0,18.1,0,40z M312,32 c4.6,0,8,3.4,8,8v272c0,4.6-3.4,8-8,8H40c-4.6,0-8-3.4-8-8V40c0-4.6,3.4-8,8-8H312z M59.5,87c0,15.2,12.3,27.5,27.5,27.5 c15.2,0,27.5-12.3,27.5-27.5c0-15.2-12.3-27.5-27.5-27.5C71.8,59.5,59.5,71.8,59.5,87z M187,157h-1v-21h-45v152h47v-75 c0-19.8,3.9-39,28.5-39c24.2,0,24.5,22.4,24.5,40v74h47v-83.5c0-40.9-8.7-72-56.5-72C208.5,132.5,193.3,145.1,187,157z M64,288h47.5 V136H64V288z"/></svg>
        </a>
    </li>
    

    
    
    <li>
      <a href="mailto:?to=patrick.nicholson%40outlook.com" target="_blank" class="social-btn email">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-mail" width="24" height="24" viewBox="0 0 416 288" fill="var(--color-primary)"><path d="m0 16v256 16h16 384 16v-16-256-16h-16-384-16zm347 16-139 92.5-139-92.5zm-148 125.5 9 5.5 9-5.5 167-111.5v210h-352v-210z"/></svg>
      </a>
    </li>
    
  </ul>
</div>
        </div>
      
    </div>
  </footer>

  








  
  
    

<script src="https://ptrcknchlsn.xyz/main.min.js"></script>



  
</body>
</html>
